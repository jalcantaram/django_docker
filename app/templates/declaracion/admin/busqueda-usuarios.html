{% extends 'layout/base.html' %}
{% load bootstrap4 %}
{% load static %}
{% load llave %}
{% block content %}
    <section class="container">
      <form action="{% url 'declaracion:busqueda-usuarios' %}" method="get" id="form">
        <div class="row row-md ">
          <div class="col-sm-12 col-md-8">
            <h1 class="text-gray text-xl font-weight-medium text-uppercase mt-5 line-height-md title-mobile text-mobile"><span class="text-primary-light font-weight-semibold">USUARIOS DE STAFF</span> Búsqueda</h1>
          </div>
          {% if msg %}
            <div class="alert alert-success" role="alert">
              <h4 class="alert-heading">¡Se han registrado el usuario <i>{{ infopersonalfija.rfc }}</i>!</h4>
              <p>Se ha enviado un correo electrónico a la persona que se acaba de registrar como usuario administrador del ente.</p>
              <hr>
              <p class="mb-0">Debe dar clic al enlace enviado a su correo. </p>
            </div>
          {% endif %}
          {% if messages %}
          {% for message in messages %}
          <div class="row">
            <div class="col-12">
              <div class="alert alert-success" role="alert">
                <h4 class="alert-heading">{{ message }}</i>!</h4>
              </div>
            </div>
          </div>
          {% endfor %}
          {% endif %}
          {% if editar%}
            <div class="alert alert-success" role="alert">
              <h4 class="alert-heading">¡Se han guardado los cambios del usuario <i>{{ infopersonalfija.rfc }}</i>!</h4>
              <p>La actualización de datos se ha realizado con éxico.</p>
              <hr>
            </div>
          {% endif %}
          <div class="col-sm-12 col-md-4 mt-4">
            {% is_auth_llave as is_auth_llave%}
            {% if not is_auth_llave %}
            <a href="{% url 'declaracion:nuevo-usuario' %}" class="btn btn-warning btn-block btn-lg font-weight-semibold text-light"> Crear usuario <img src="{% static 'src/img/group.svg' %}"></a>
            {% endif %}
          </div>
        </div>
        <div class="row row-md">
          <div class="d-flex justify-content-center align-items-center flex-column flex-sm-row bg-gray p-4 rounded">
            {% bootstrap_field form.page %}
            <div class="row">
              <div class="col-sm-12 col-md-6 col-lg-4 col-xl-4">
                {% if is_auth_llave %}
                <label> RFC</label>
                {% else %}
                <label> Usuario</label>
                {% endif %}
                {% bootstrap_field form.usuario field_class="valida_rfc" show_label=False %}
              </div>
              <div class="col-sm-12 col-md-6 col-lg-4 col-xl-4">
                {% bootstrap_field form.nombre  field_class="solo_letras" %}
              </div>
              <div class="col-sm-12 col-md-6 col-lg-4 col-xl-4">
                {% bootstrap_field form.apellidos  field_class="solo_letras" %}
              </div>
              <div class="col-sm-12 col-md-6 col-lg-4 col-xl-4">
                <label> Ente público</label>
                {% bootstrap_field form.ente show_label=False %}
              </div>
              <div class="col-sm-12 col-md-6 col-lg-4 col-xl-4">
                {% bootstrap_field form.estatus  %}
              </div>
              <div class="col-sm-12 col-md-6 col-lg-4 col-xl-4 ">
                <button class="btn btn-success-lighter text-uppercase font-weight-semibold mt-5" type="submit">Buscar  <img src="{% static 'src/img/busqueda.svg' %}"/></button>
              </div>
              <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12 ">
                <strong>Se encontr{{ count|pluralize:"ó,aron" }} {{count}} usuario{{ count|pluralize:",s" }}</strong>
              </div>
            </div>
          </div>
        </div>
      </form>
      <div class="row row-md">
        <table class="table table-striped text-center">
          <thead>
            <tr>
              <th scope="col">NOMBRE</th>
              <th scope="col">APELLIDOS</th>
              <th scope="col">USUARIO</th>
              <th scope="col">EMAIL</th>
              <th scope="col">ES SUPERUSUARIO</th>
              <th scope="col">ESTATUS</th>
              <th scope="col">VER DETALLE</th>
              <th scope="col">ELIMINAR</th>
            </tr>
          </thead>
          <tbody>
            {% for user in object_list %}
              <tr id="id-usuario-{{ user.usuario.id }}">
                <td scope="row">{{ user.first_name|default:"-" }}</td>
                <td>{{ user.last_name|default:"-" }}</td>
                <td>{{ user.username|default:"-" }}</td>
                <td>{{ user.email|default:"-" }}</td>
                <td>{% if user.is_superuser %} <span class="text-primary-light"> ✅ </span> {% else %} ❌ {% endif %} </td>
                <td>{% if user.is_active %} <span class="text-primary-light"> ✅ </span> {% else %} ❌ {% endif %} </td>
                <td>
                  <a href="{%  url 'declaracion:info-usuario' user.id %}"> <img src="{% static 'src/img/reconocimiento-facial-2.svg' %}"></a>
                </td>
                <td>
                  <button class="btn btn-link btn-link-plus" type="button" name="button"  data-toggle="modal" data-target="#modal" onclick="$('#id-usuario').val({{ user.id }});$('#nombre-usuario').html('{{ user.username }}'); ">
                    <img src="{% static 'src/img/eliminar.svg' %}">
                  </button>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="modal" tabindex="-1" role="dialog" id="modal">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Eliminar Usuario</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <p>¿Está seguro de elminar este usuario <span id="nombre-usuario" class="text-primary-light font-weight-semibold"></span> ?</p>
              <form method="post"  id="elimina_usuario_form" >
                {% csrf_token %}
                <input type="hidden" id="id-usuario"/>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" onclick="dui.borraUsuario('{% url 'declaracion:eliminar-usuario' 0 %}','elimina_usuario_form',true)">Eliminar</button>
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
            </div>
          </div>
        </div>
      </div>
      <div class="row row-md text-center">
        <div class="col-12">
          {% include 'elementos/paginator.html' %}
        </div>
      </div>
    </section>
{% endblock %}
